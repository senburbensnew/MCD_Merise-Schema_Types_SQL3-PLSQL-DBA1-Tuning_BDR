SQL> 
SQL> --------------------------------------------------------------------------------------------
SQL> --------------------------------------------------------------------------------------------
SQL> -- 1. Supprimer les indexes recommandés dans EXO91 et posés dans EXO91_TUNED
SQL> --------------------------------------------------------------------------------------------
SQL> --------------------------------------------------------------------------------------------
SQL> 
SQL> -- liste des indexes actuels
SQL> 
SQL> select table_name, column_name, index_name
  2  from user_ind_columns
  3  where table_name in ('O_EXAMEN','O_CONSULTATION','O_PRESCRIPTION','O_FACTURE','O_RENDEZ_VOUS','O_MEDECIN','O_PATIENT')
  4  order by table_name, index_name, column_name;

TABLE_NAME                                                                      
--------------------------------------------------------------------------------
COLUMN_NAME                                                                     
--------------------------------------------------------------------------------
INDEX_NAME                                                                      
--------------------------------------------------------------------------------
O_CONSULTATION                                                                  
REFMEDECIN                                                                      
IDX_O_CONSULTATION_REFMEDECIN                                                   
                                                                                
O_CONSULTATION                                                                  
REFPATIENT                                                                      
IDX_O_CONSULTATION_REFPATIENT                                                   

TABLE_NAME                                                                      
--------------------------------------------------------------------------------
COLUMN_NAME                                                                     
--------------------------------------------------------------------------------
INDEX_NAME                                                                      
--------------------------------------------------------------------------------
                                                                                
O_CONSULTATION                                                                  
DATE_CONSULTATION                                                               
IDX_O_CONSULTATION_REF_PATIENT_REF_MEDECIN_DATE_UNIQUE                          
                                                                                
O_CONSULTATION                                                                  
REFMEDECIN                                                                      

TABLE_NAME                                                                      
--------------------------------------------------------------------------------
COLUMN_NAME                                                                     
--------------------------------------------------------------------------------
INDEX_NAME                                                                      
--------------------------------------------------------------------------------
IDX_O_CONSULTATION_REF_PATIENT_REF_MEDECIN_DATE_UNIQUE                          
                                                                                
O_CONSULTATION                                                                  
REFPATIENT                                                                      
IDX_O_CONSULTATION_REF_PATIENT_REF_MEDECIN_DATE_UNIQUE                          
                                                                                
O_CONSULTATION                                                                  

TABLE_NAME                                                                      
--------------------------------------------------------------------------------
COLUMN_NAME                                                                     
--------------------------------------------------------------------------------
INDEX_NAME                                                                      
--------------------------------------------------------------------------------
ID_CONSULTATION                                                                 
PK_O_CONSULTATION_ID_CONSULTATION                                               
                                                                                
O_CONSULTATION                                                                  
PLISTREFPRESCRIPTIONS                                                           
SYS_C008613                                                                     
                                                                                

TABLE_NAME                                                                      
--------------------------------------------------------------------------------
COLUMN_NAME                                                                     
--------------------------------------------------------------------------------
INDEX_NAME                                                                      
--------------------------------------------------------------------------------
O_CONSULTATION                                                                  
PLISTREFEXAMENS                                                                 
SYS_C008614                                                                     
                                                                                
O_CONSULTATION                                                                  
SYS_NC_OID$                                                                     
SYS_C008615                                                                     

TABLE_NAME                                                                      
--------------------------------------------------------------------------------
COLUMN_NAME                                                                     
--------------------------------------------------------------------------------
INDEX_NAME                                                                      
--------------------------------------------------------------------------------
                                                                                
O_EXAMEN                                                                        
REFCONSULTATION                                                                 
IDX_O_EXAMEN_REFCONSULTATION                                                    
                                                                                
O_EXAMEN                                                                        
ID_EXAMEN                                                                       

TABLE_NAME                                                                      
--------------------------------------------------------------------------------
COLUMN_NAME                                                                     
--------------------------------------------------------------------------------
INDEX_NAME                                                                      
--------------------------------------------------------------------------------
PK_O_EXAMEN_ID_EXAMEN                                                           
                                                                                
O_EXAMEN                                                                        
SYS_NC_OID$                                                                     
SYS_C008590                                                                     
                                                                                
O_FACTURE                                                                       

TABLE_NAME                                                                      
--------------------------------------------------------------------------------
COLUMN_NAME                                                                     
--------------------------------------------------------------------------------
INDEX_NAME                                                                      
--------------------------------------------------------------------------------
MONTANT_TOTAL                                                                   
IDX_O_FACTURE_MONTANT_TOTAL                                                     
                                                                                
O_FACTURE                                                                       
REFCONSULTATION                                                                 
IDX_O_FACTURE_REFCONSULTATION                                                   
                                                                                

TABLE_NAME                                                                      
--------------------------------------------------------------------------------
COLUMN_NAME                                                                     
--------------------------------------------------------------------------------
INDEX_NAME                                                                      
--------------------------------------------------------------------------------
O_FACTURE                                                                       
REFPATIENT                                                                      
IDX_O_FACTURE_REFPATIENT                                                        
                                                                                
O_FACTURE                                                                       
ID_FACTURE                                                                      
PK_O_FACTURE_ID_FACTURE                                                         

TABLE_NAME                                                                      
--------------------------------------------------------------------------------
COLUMN_NAME                                                                     
--------------------------------------------------------------------------------
INDEX_NAME                                                                      
--------------------------------------------------------------------------------
                                                                                
O_FACTURE                                                                       
SYS_NC_OID$                                                                     
SYS_C008601                                                                     
                                                                                
O_MEDECIN                                                                       
EMAIL                                                                           

TABLE_NAME                                                                      
--------------------------------------------------------------------------------
COLUMN_NAME                                                                     
--------------------------------------------------------------------------------
INDEX_NAME                                                                      
--------------------------------------------------------------------------------
IDX_O_MEDECIN_EMAIL_UNIQUE                                                      
                                                                                
O_MEDECIN                                                                       
NUMERO_SECURITE_SOCIALE                                                         
IDX_O_MEDECIN_NUM_SEC_SOCIAL_UNIQUE                                             
                                                                                
O_MEDECIN                                                                       

TABLE_NAME                                                                      
--------------------------------------------------------------------------------
COLUMN_NAME                                                                     
--------------------------------------------------------------------------------
INDEX_NAME                                                                      
--------------------------------------------------------------------------------
SPECIALITE                                                                      
IDX_O_MEDECIN_SPECIALITE                                                        
                                                                                
O_MEDECIN                                                                       
ID_PERSONNE                                                                     
PK_O_MEDECIN_ID_PERSONNE                                                        
                                                                                

TABLE_NAME                                                                      
--------------------------------------------------------------------------------
COLUMN_NAME                                                                     
--------------------------------------------------------------------------------
INDEX_NAME                                                                      
--------------------------------------------------------------------------------
O_MEDECIN                                                                       
PLISTREFCONSULTATIONS                                                           
SYS_C008583                                                                     
                                                                                
O_MEDECIN                                                                       
PLISTREFRENDEZVOUS                                                              
SYS_C008584                                                                     

TABLE_NAME                                                                      
--------------------------------------------------------------------------------
COLUMN_NAME                                                                     
--------------------------------------------------------------------------------
INDEX_NAME                                                                      
--------------------------------------------------------------------------------
                                                                                
O_MEDECIN                                                                       
SYS_NC_OID$                                                                     
SYS_C008585                                                                     
                                                                                
O_PATIENT                                                                       
EMAIL                                                                           

TABLE_NAME                                                                      
--------------------------------------------------------------------------------
COLUMN_NAME                                                                     
--------------------------------------------------------------------------------
INDEX_NAME                                                                      
--------------------------------------------------------------------------------
IDX_O_PATIENT_EMAIL_UNIQUE                                                      
                                                                                
O_PATIENT                                                                       
NUMERO_SECURITE_SOCIALE                                                         
IDX_O_PATIENT_NUM_SEC_SOCIAL_UNIQUE                                             
                                                                                
O_PATIENT                                                                       

TABLE_NAME                                                                      
--------------------------------------------------------------------------------
COLUMN_NAME                                                                     
--------------------------------------------------------------------------------
INDEX_NAME                                                                      
--------------------------------------------------------------------------------
ID_PERSONNE                                                                     
PK_O_PATIENT_ID_PERSONNE                                                        
                                                                                
O_PATIENT                                                                       
PLISTREFFACTURES                                                                
SYS_C008570                                                                     
                                                                                

TABLE_NAME                                                                      
--------------------------------------------------------------------------------
COLUMN_NAME                                                                     
--------------------------------------------------------------------------------
INDEX_NAME                                                                      
--------------------------------------------------------------------------------
O_PATIENT                                                                       
PLISTREFCONSULTATIONS                                                           
SYS_C008571                                                                     
                                                                                
O_PATIENT                                                                       
PLISTREFRENDEZVOUS                                                              
SYS_C008572                                                                     

TABLE_NAME                                                                      
--------------------------------------------------------------------------------
COLUMN_NAME                                                                     
--------------------------------------------------------------------------------
INDEX_NAME                                                                      
--------------------------------------------------------------------------------
                                                                                
O_PATIENT                                                                       
SYS_NC_OID$                                                                     
SYS_C008573                                                                     
                                                                                
O_PRESCRIPTION                                                                  
REFCONSULTATION                                                                 

TABLE_NAME                                                                      
--------------------------------------------------------------------------------
COLUMN_NAME                                                                     
--------------------------------------------------------------------------------
INDEX_NAME                                                                      
--------------------------------------------------------------------------------
IDX_O_PRESCRIPTION_REFCONSULTATION                                              
                                                                                
O_PRESCRIPTION                                                                  
ID_PRESCRIPTION                                                                 
PK_O_PRESCRIPTION_ID_PRESCRIPTION                                               
                                                                                
O_PRESCRIPTION                                                                  

TABLE_NAME                                                                      
--------------------------------------------------------------------------------
COLUMN_NAME                                                                     
--------------------------------------------------------------------------------
INDEX_NAME                                                                      
--------------------------------------------------------------------------------
SYS_NC_OID$                                                                     
SYS_C008595                                                                     
                                                                                
O_RENDEZ_VOUS                                                                   
REFMEDECIN                                                                      
IDX_O_RENDEZ_VOUS_REFMEDECIN                                                    
                                                                                

TABLE_NAME                                                                      
--------------------------------------------------------------------------------
COLUMN_NAME                                                                     
--------------------------------------------------------------------------------
INDEX_NAME                                                                      
--------------------------------------------------------------------------------
O_RENDEZ_VOUS                                                                   
REFPATIENT                                                                      
IDX_O_RENDEZ_VOUS_REFPATIENT                                                    
                                                                                
O_RENDEZ_VOUS                                                                   
DATE_RENDEZ_VOUS                                                                
IDX_O_RENDEZ_VOUS_REF_PATIENT_REF_MEDECIN_DATE_UNIQUE                           

TABLE_NAME                                                                      
--------------------------------------------------------------------------------
COLUMN_NAME                                                                     
--------------------------------------------------------------------------------
INDEX_NAME                                                                      
--------------------------------------------------------------------------------
                                                                                
O_RENDEZ_VOUS                                                                   
REFMEDECIN                                                                      
IDX_O_RENDEZ_VOUS_REF_PATIENT_REF_MEDECIN_DATE_UNIQUE                           
                                                                                
O_RENDEZ_VOUS                                                                   
REFPATIENT                                                                      

TABLE_NAME                                                                      
--------------------------------------------------------------------------------
COLUMN_NAME                                                                     
--------------------------------------------------------------------------------
INDEX_NAME                                                                      
--------------------------------------------------------------------------------
IDX_O_RENDEZ_VOUS_REF_PATIENT_REF_MEDECIN_DATE_UNIQUE                           
                                                                                
O_RENDEZ_VOUS                                                                   
ID_RENDEZ_VOUS                                                                  
PK_O_RENDEZ_VOUS_ID_RENDEZ_VOUS                                                 
                                                                                
O_RENDEZ_VOUS                                                                   

TABLE_NAME                                                                      
--------------------------------------------------------------------------------
COLUMN_NAME                                                                     
--------------------------------------------------------------------------------
INDEX_NAME                                                                      
--------------------------------------------------------------------------------
SYS_NC_OID$                                                                     
SYS_C008607                                                                     
                                                                                

41 rows selected.

SQL> 
SQL> /*
SQL> -- suppression des indexes posés dans le EXO91
SQL> 
SQL> declare
SQL> 
SQL> sql_stmt	     varchar2(200);
SQL> cursor c1 is
SQL> 	     select index_name
SQL> 	     from user_indexes
SQL> 	     where table_name in ('O_EXAMEN','O_CONSULTATION','O_PRESCRIPTION','O_FACTURE','O_RENDEZ_VOUS','O_MEDECIN','O_PATIENT')
SQL> 	     and
SQL> 	     (UNIQUENESS = 'NONUNIQUE'
SQL> 		     OR
SQL> 		     (UNIQUENESS='UNIQUE'
SQL> 			     and index_name not in (
SQL> 			     select constraint_name
SQL> 			     from user_constraints
SQL> 			     where constraint_type
SQL> 			     IN ('P', 'U')
SQL> 			     )
SQL> 		     )
SQL> 	     );
SQL> begin
SQL> 	     for C1_elem in c1
SQL> 	     loop
SQL> 		     sql_stmt:= 'drop index ' || c1_elem.index_name;
SQL> 		     EXECUTE IMMEDIATE sql_stmt;
SQL> 	     end loop;
SQL> 
SQL> end;
SQL> /
SQL> */
SQL> 
SQL> -- liste des indexes après
SQL> select table_name, column_name, index_name
  2  from user_ind_columns
  3  where table_name in ('O_EXAMEN','O_CONSULTATION','O_PRESCRIPTION','O_FACTURE','O_RENDEZ_VOUS','O_MEDECIN','O_PATIENT')
  4  order by table_name, index_name, column_name;

TABLE_NAME                                                                      
--------------------------------------------------------------------------------
COLUMN_NAME                                                                     
--------------------------------------------------------------------------------
INDEX_NAME                                                                      
--------------------------------------------------------------------------------
O_CONSULTATION                                                                  
REFMEDECIN                                                                      
IDX_O_CONSULTATION_REFMEDECIN                                                   
                                                                                
O_CONSULTATION                                                                  
REFPATIENT                                                                      
IDX_O_CONSULTATION_REFPATIENT                                                   

TABLE_NAME                                                                      
--------------------------------------------------------------------------------
COLUMN_NAME                                                                     
--------------------------------------------------------------------------------
INDEX_NAME                                                                      
--------------------------------------------------------------------------------
                                                                                
O_CONSULTATION                                                                  
DATE_CONSULTATION                                                               
IDX_O_CONSULTATION_REF_PATIENT_REF_MEDECIN_DATE_UNIQUE                          
                                                                                
O_CONSULTATION                                                                  
REFMEDECIN                                                                      

TABLE_NAME                                                                      
--------------------------------------------------------------------------------
COLUMN_NAME                                                                     
--------------------------------------------------------------------------------
INDEX_NAME                                                                      
--------------------------------------------------------------------------------
IDX_O_CONSULTATION_REF_PATIENT_REF_MEDECIN_DATE_UNIQUE                          
                                                                                
O_CONSULTATION                                                                  
REFPATIENT                                                                      
IDX_O_CONSULTATION_REF_PATIENT_REF_MEDECIN_DATE_UNIQUE                          
                                                                                
O_CONSULTATION                                                                  

TABLE_NAME                                                                      
--------------------------------------------------------------------------------
COLUMN_NAME                                                                     
--------------------------------------------------------------------------------
INDEX_NAME                                                                      
--------------------------------------------------------------------------------
ID_CONSULTATION                                                                 
PK_O_CONSULTATION_ID_CONSULTATION                                               
                                                                                
O_CONSULTATION                                                                  
PLISTREFPRESCRIPTIONS                                                           
SYS_C008613                                                                     
                                                                                

TABLE_NAME                                                                      
--------------------------------------------------------------------------------
COLUMN_NAME                                                                     
--------------------------------------------------------------------------------
INDEX_NAME                                                                      
--------------------------------------------------------------------------------
O_CONSULTATION                                                                  
PLISTREFEXAMENS                                                                 
SYS_C008614                                                                     
                                                                                
O_CONSULTATION                                                                  
SYS_NC_OID$                                                                     
SYS_C008615                                                                     

TABLE_NAME                                                                      
--------------------------------------------------------------------------------
COLUMN_NAME                                                                     
--------------------------------------------------------------------------------
INDEX_NAME                                                                      
--------------------------------------------------------------------------------
                                                                                
O_EXAMEN                                                                        
REFCONSULTATION                                                                 
IDX_O_EXAMEN_REFCONSULTATION                                                    
                                                                                
O_EXAMEN                                                                        
ID_EXAMEN                                                                       

TABLE_NAME                                                                      
--------------------------------------------------------------------------------
COLUMN_NAME                                                                     
--------------------------------------------------------------------------------
INDEX_NAME                                                                      
--------------------------------------------------------------------------------
PK_O_EXAMEN_ID_EXAMEN                                                           
                                                                                
O_EXAMEN                                                                        
SYS_NC_OID$                                                                     
SYS_C008590                                                                     
                                                                                
O_FACTURE                                                                       

TABLE_NAME                                                                      
--------------------------------------------------------------------------------
COLUMN_NAME                                                                     
--------------------------------------------------------------------------------
INDEX_NAME                                                                      
--------------------------------------------------------------------------------
MONTANT_TOTAL                                                                   
IDX_O_FACTURE_MONTANT_TOTAL                                                     
                                                                                
O_FACTURE                                                                       
REFCONSULTATION                                                                 
IDX_O_FACTURE_REFCONSULTATION                                                   
                                                                                

TABLE_NAME                                                                      
--------------------------------------------------------------------------------
COLUMN_NAME                                                                     
--------------------------------------------------------------------------------
INDEX_NAME                                                                      
--------------------------------------------------------------------------------
O_FACTURE                                                                       
REFPATIENT                                                                      
IDX_O_FACTURE_REFPATIENT                                                        
                                                                                
O_FACTURE                                                                       
ID_FACTURE                                                                      
PK_O_FACTURE_ID_FACTURE                                                         

TABLE_NAME                                                                      
--------------------------------------------------------------------------------
COLUMN_NAME                                                                     
--------------------------------------------------------------------------------
INDEX_NAME                                                                      
--------------------------------------------------------------------------------
                                                                                
O_FACTURE                                                                       
SYS_NC_OID$                                                                     
SYS_C008601                                                                     
                                                                                
O_MEDECIN                                                                       
EMAIL                                                                           

TABLE_NAME                                                                      
--------------------------------------------------------------------------------
COLUMN_NAME                                                                     
--------------------------------------------------------------------------------
INDEX_NAME                                                                      
--------------------------------------------------------------------------------
IDX_O_MEDECIN_EMAIL_UNIQUE                                                      
                                                                                
O_MEDECIN                                                                       
NUMERO_SECURITE_SOCIALE                                                         
IDX_O_MEDECIN_NUM_SEC_SOCIAL_UNIQUE                                             
                                                                                
O_MEDECIN                                                                       

TABLE_NAME                                                                      
--------------------------------------------------------------------------------
COLUMN_NAME                                                                     
--------------------------------------------------------------------------------
INDEX_NAME                                                                      
--------------------------------------------------------------------------------
SPECIALITE                                                                      
IDX_O_MEDECIN_SPECIALITE                                                        
                                                                                
O_MEDECIN                                                                       
ID_PERSONNE                                                                     
PK_O_MEDECIN_ID_PERSONNE                                                        
                                                                                

TABLE_NAME                                                                      
--------------------------------------------------------------------------------
COLUMN_NAME                                                                     
--------------------------------------------------------------------------------
INDEX_NAME                                                                      
--------------------------------------------------------------------------------
O_MEDECIN                                                                       
PLISTREFCONSULTATIONS                                                           
SYS_C008583                                                                     
                                                                                
O_MEDECIN                                                                       
PLISTREFRENDEZVOUS                                                              
SYS_C008584                                                                     

TABLE_NAME                                                                      
--------------------------------------------------------------------------------
COLUMN_NAME                                                                     
--------------------------------------------------------------------------------
INDEX_NAME                                                                      
--------------------------------------------------------------------------------
                                                                                
O_MEDECIN                                                                       
SYS_NC_OID$                                                                     
SYS_C008585                                                                     
                                                                                
O_PATIENT                                                                       
EMAIL                                                                           

TABLE_NAME                                                                      
--------------------------------------------------------------------------------
COLUMN_NAME                                                                     
--------------------------------------------------------------------------------
INDEX_NAME                                                                      
--------------------------------------------------------------------------------
IDX_O_PATIENT_EMAIL_UNIQUE                                                      
                                                                                
O_PATIENT                                                                       
NUMERO_SECURITE_SOCIALE                                                         
IDX_O_PATIENT_NUM_SEC_SOCIAL_UNIQUE                                             
                                                                                
O_PATIENT                                                                       

TABLE_NAME                                                                      
--------------------------------------------------------------------------------
COLUMN_NAME                                                                     
--------------------------------------------------------------------------------
INDEX_NAME                                                                      
--------------------------------------------------------------------------------
ID_PERSONNE                                                                     
PK_O_PATIENT_ID_PERSONNE                                                        
                                                                                
O_PATIENT                                                                       
PLISTREFFACTURES                                                                
SYS_C008570                                                                     
                                                                                

TABLE_NAME                                                                      
--------------------------------------------------------------------------------
COLUMN_NAME                                                                     
--------------------------------------------------------------------------------
INDEX_NAME                                                                      
--------------------------------------------------------------------------------
O_PATIENT                                                                       
PLISTREFCONSULTATIONS                                                           
SYS_C008571                                                                     
                                                                                
O_PATIENT                                                                       
PLISTREFRENDEZVOUS                                                              
SYS_C008572                                                                     

TABLE_NAME                                                                      
--------------------------------------------------------------------------------
COLUMN_NAME                                                                     
--------------------------------------------------------------------------------
INDEX_NAME                                                                      
--------------------------------------------------------------------------------
                                                                                
O_PATIENT                                                                       
SYS_NC_OID$                                                                     
SYS_C008573                                                                     
                                                                                
O_PRESCRIPTION                                                                  
REFCONSULTATION                                                                 

TABLE_NAME                                                                      
--------------------------------------------------------------------------------
COLUMN_NAME                                                                     
--------------------------------------------------------------------------------
INDEX_NAME                                                                      
--------------------------------------------------------------------------------
IDX_O_PRESCRIPTION_REFCONSULTATION                                              
                                                                                
O_PRESCRIPTION                                                                  
ID_PRESCRIPTION                                                                 
PK_O_PRESCRIPTION_ID_PRESCRIPTION                                               
                                                                                
O_PRESCRIPTION                                                                  

TABLE_NAME                                                                      
--------------------------------------------------------------------------------
COLUMN_NAME                                                                     
--------------------------------------------------------------------------------
INDEX_NAME                                                                      
--------------------------------------------------------------------------------
SYS_NC_OID$                                                                     
SYS_C008595                                                                     
                                                                                
O_RENDEZ_VOUS                                                                   
REFMEDECIN                                                                      
IDX_O_RENDEZ_VOUS_REFMEDECIN                                                    
                                                                                

TABLE_NAME                                                                      
--------------------------------------------------------------------------------
COLUMN_NAME                                                                     
--------------------------------------------------------------------------------
INDEX_NAME                                                                      
--------------------------------------------------------------------------------
O_RENDEZ_VOUS                                                                   
REFPATIENT                                                                      
IDX_O_RENDEZ_VOUS_REFPATIENT                                                    
                                                                                
O_RENDEZ_VOUS                                                                   
DATE_RENDEZ_VOUS                                                                
IDX_O_RENDEZ_VOUS_REF_PATIENT_REF_MEDECIN_DATE_UNIQUE                           

TABLE_NAME                                                                      
--------------------------------------------------------------------------------
COLUMN_NAME                                                                     
--------------------------------------------------------------------------------
INDEX_NAME                                                                      
--------------------------------------------------------------------------------
                                                                                
O_RENDEZ_VOUS                                                                   
REFMEDECIN                                                                      
IDX_O_RENDEZ_VOUS_REF_PATIENT_REF_MEDECIN_DATE_UNIQUE                           
                                                                                
O_RENDEZ_VOUS                                                                   
REFPATIENT                                                                      

TABLE_NAME                                                                      
--------------------------------------------------------------------------------
COLUMN_NAME                                                                     
--------------------------------------------------------------------------------
INDEX_NAME                                                                      
--------------------------------------------------------------------------------
IDX_O_RENDEZ_VOUS_REF_PATIENT_REF_MEDECIN_DATE_UNIQUE                           
                                                                                
O_RENDEZ_VOUS                                                                   
ID_RENDEZ_VOUS                                                                  
PK_O_RENDEZ_VOUS_ID_RENDEZ_VOUS                                                 
                                                                                
O_RENDEZ_VOUS                                                                   

TABLE_NAME                                                                      
--------------------------------------------------------------------------------
COLUMN_NAME                                                                     
--------------------------------------------------------------------------------
INDEX_NAME                                                                      
--------------------------------------------------------------------------------
SYS_NC_OID$                                                                     
SYS_C008607                                                                     
                                                                                

41 rows selected.

SQL> 
SQL> 
SQL> --------------------------------------------------------------------------------------------
SQL> --------------------------------------------------------------------------------------------
SQL> -- 2. Charger les requêtes dans la table utilisateur user_workload
SQL> --------------------------------------------------------------------------------------------
SQL> --------------------------------------------------------------------------------------------
SQL> 
SQL> -- Si utile Suppession puis création de la table utilisateur
SQL> drop table user_workload;
drop table user_workload
           *
ERROR at line 1:
ORA-00942: table or view does not exist 


SQL> 
SQL> 
SQL> create table user_workload(
  2  MODULE VARCHAR2(64) ,   --Nom du module applicatif.
  3  ACTION VARCHAR2(64),    -- Action sur l'application.
  4  BUFFER_GETS NUMBER default 0, --nbre total de buffer-gets pour la requête.
  5  CPU_TIME NUMBER default 0, -- Total CPU time in seconds for the statement.
  6  ELAPSED_TIME NUMBER default 0, -- Total elapsed time in seconds for the statement.
  7  DISK_READS NUMBER default 0 , --Total number of disk-read operations used
  8  				     -- by the statement.
  9  ROWS_PROCESSED NUMBER default 0, --  Total number of rows process by this
 10  				     -- SQL statement.
 11  EXECUTIONS NUMBER default 1, -- Total number of times the statement is executed.
 12  OPTIMIZER_COST NUMBER default  0, -- Optimizer's calculated cost value for
 13  					       -- executing the query.
 14  LAST_EXECUTION_DATE DATE  default SYSDATE , -- Last time the query is
 15  				     -- used. Defaults to not available.
 16  PRIORITY NUMBER default 2,      --  Must be one of the following values:
 17  				     -- 1- HIGH, 2- MEDIUM, or 3- LOW
 18  SQL_TEXT CLOB,	     --  or LONG or VARCHAR2
 19  				     -- None The SQL statement. This is a required		     -- column.
 20  STAT_PERIOD NUMBER default 1 ,
 21  -- Period of time that corresponds to the execution statistics in seconds.
 22  USERNAME VARCHAR(30) default user
 23  --Current user User submitting the query. This is a required column.
 24  );

Table created.

SQL> 
SQL> 
SQL> 
SQL> -- chargement des requêtes dans cette table
SQL> -- aggregation with selection
SQL> 
SQL> INSERT INTO user_workload (username, module, action, priority, sql_text)
  2  VALUES ('&MYPDBUSER', 'Example1', 'Action', 2,
  3  ' SELECT * FROM O_PATIENT OP')
  4  /
old   2: VALUES ('&MYPDBUSER', 'Example1', 'Action', 2,
new   2: VALUES ('GESTION_CABINET_MEDICAL', 'Example1', 'Action', 2,

1 row created.

SQL> 
SQL> 
SQL>  INSERT INTO user_workload (username, module, action, priority, sql_text)
  2  VALUES ('&MYPDBUSER', 'Example2', 'Action', 2,
  3   'SELECT * FROM O_CONSULTATION OC');
old   2: VALUES ('&MYPDBUSER', 'Example2', 'Action', 2,
new   2: VALUES ('GESTION_CABINET_MEDICAL', 'Example2', 'Action', 2,

1 row created.

SQL> 
SQL> 
SQL> 
SQL> INSERT INTO user_workload (username, module, action, priority, sql_text)
  2  VALUES ('&MYPDBUSER', 'Example3', 'Action', 2,
  3   'SELECT E.details_examens, COUNT(*) AS NB_LIGNES
  4  FROM (SELECT DISTINCT oe.Details_Examen AS details_examens FROM O_EXAMEN oe) E
  5  GROUP BY E.details_examens');
old   2: VALUES ('&MYPDBUSER', 'Example3', 'Action', 2,
new   2: VALUES ('GESTION_CABINET_MEDICAL', 'Example3', 'Action', 2,

1 row created.

SQL> 
SQL> 
SQL>  -- liste des transactions par compte et client pour lesquels le solde du compte négatif
SQL>  INSERT INTO user_workload (username, module, action, priority, sql_text)
  2   VALUES ('&MYPDBUSER', 'Example3', 'Action', 2,'SELECT E.details_examens, COUNT(*) AS NB_LIGNES
  3  FROM (SELECT DISTINCT oe.Details_Examen AS details_examens FROM O_EXAMEN oe) E
  4  GROUP BY E.details_examens
  5  ORDER BY E.details_examens ASC');
old   2:  VALUES ('&MYPDBUSER', 'Example3', 'Action', 2,'SELECT E.details_examens, COUNT(*) AS NB_LIGNES
new   2:  VALUES ('GESTION_CABINET_MEDICAL', 'Example3', 'Action', 2,'SELECT E.details_examens, COUNT(*) AS NB_LIGNES

1 row created.

SQL> 
SQL> -- liste des transactions par compte et client connaissant le nom du client
SQL>  INSERT INTO user_workload (username, module, action, priority, sql_text)
  2   VALUES ('&MYPDBUSER', 'Example5', 'Action', 2,
  3   'SELECT COUNT(*) nb_total_factures, SUM(OFA.Montant_Total) somme_montants_totaux
  4  FROM O_FACTURE OFA
  5  GROUP BY OFA.refPatient.ID_PERSONNE
  6  ORDER BY OFA.refPatient.ID_PERSONNE');
old   2:  VALUES ('&MYPDBUSER', 'Example5', 'Action', 2,
new   2:  VALUES ('GESTION_CABINET_MEDICAL', 'Example5', 'Action', 2,

1 row created.

SQL> 
SQL>  -- liste des transactions par compte et client connaissant le nom du client et opérées à une date donnée
SQL>  INSERT INTO user_workload (username, module, action, priority, sql_text)
  2   VALUES ('&MYPDBUSER', 'Example6', 'Action', 2,
  3   'SELECT OC.*, DEREF(OC.refPatient) AS PATIENT FROM O_CONSULTATION OC');
old   2:  VALUES ('&MYPDBUSER', 'Example6', 'Action', 2,
new   2:  VALUES ('GESTION_CABINET_MEDICAL', 'Example6', 'Action', 2,

1 row created.

SQL> 
SQL>  -- 7ème requête
SQL>  -- liste des opération d'un client données de type DEBIT
SQL> INSERT INTO user_workload (username, module, action, priority, sql_text)
  2   VALUES ('&MYPDBUSER', 'Example7', 'Action', 2,
  3   'SELECT OFA.*, DEREF(OFA.refPatient) AS PATIENT FROM O_FACTURE OFA');
old   2:  VALUES ('&MYPDBUSER', 'Example7', 'Action', 2,
new   2:  VALUES ('GESTION_CABINET_MEDICAL', 'Example7', 'Action', 2,

1 row created.

SQL> 
SQL>  -- Erreur 1 : total des transaction par client, par compte, par operation
SQL> INSERT INTO user_workload (username, module, action, priority, sql_text)
  2  VALUES ('&MYPDBUSER', 'Example8', 'Action', 2,
  3   'SELECT OC.*, DEREF(OC.refPatient) AS PATIENT
  4  FROM O_CONSULTATION OC
  5  ORDER BY OC.Date_Consultation ASC');
old   2: VALUES ('&MYPDBUSER', 'Example8', 'Action', 2,
new   2: VALUES ('GESTION_CABINET_MEDICAL', 'Example8', 'Action', 2,

1 row created.

SQL> 
SQL>  -- Erreur 2 : total des transaction par client, par compte, par operation
SQL>  -- dont le total est supérieur à 10000
SQL>  INSERT INTO user_workload (username, module, action, priority, sql_text)
  2  VALUES ('&MYPDBUSER', 'Example9', 'Action', 2,
  3   'SELECT OFA.refPatient.ID_PERSONNE AS ID_PATIENT, OFA.refPatient.EMAIL AS EMAIL, SUM(OFA.Montant_Total) AS MONTANT_TOTAL
  4  FROM O_FACTURE OFA
  5  GROUP BY OFA.refPatient.ID_PERSONNE, OFA.refPatient.EMAIL
  6  ORDER BY OFA.refPatient.ID_PERSONNE, OFA.refPatient.EMAIL DESC');
old   2: VALUES ('&MYPDBUSER', 'Example9', 'Action', 2,
new   2: VALUES ('GESTION_CABINET_MEDICAL', 'Example9', 'Action', 2,

1 row created.

SQL> 
SQL> 
SQL> -- 10ème balance des transactions par type et par date
SQL> INSERT INTO user_workload (username, module, action, priority, sql_text)
  2  VALUES ('&MYPDBUSER', 'Example10', 'Action', 2,
  3   'SELECT
  4  OE.*,
  5  DEREF(OE.refConsultation) AS CONSULTATION,
  6  DEREF(DEREF(OE.refConsultation).refPatient) AS PATIENT
  7  FROM O_EXAMEN OE');
old   2: VALUES ('&MYPDBUSER', 'Example10', 'Action', 2,
new   2: VALUES ('GESTION_CABINET_MEDICAL', 'Example10', 'Action', 2,

1 row created.

SQL> 
SQL> -- balance des transactions par type
SQL> INSERT INTO user_workload (username, module, action, priority, sql_text)
  2  VALUES ('&MYPDBUSER', 'Example11', 'Action', 2,
  3   'SELECT
  4  OFA.*,
  5  OFA.refPatient AS PATIENT,
  6  OFA.refConsultation AS CONSULTATION
  7  FROM O_FACTURE OFA');
old   2: VALUES ('&MYPDBUSER', 'Example11', 'Action', 2,
new   2: VALUES ('GESTION_CABINET_MEDICAL', 'Example11', 'Action', 2,

1 row created.

SQL> 
SQL>  -- balance des transactions par type pour des compte épargne entre deux dates
SQL>   INSERT INTO user_workload (username, module, action, priority, sql_text)
  2  VALUES ('&MYPDBUSER', 'Example12', 'Action', 2,
  3   'SELECT
  4  OE.*,
  5  DEREF(OE.refConsultation) AS CONSULTATION,
  6  DEREF(DEREF(OE.refConsultation).refPatient) AS PATIENT
  7  FROM O_EXAMEN OE
  8  ORDER BY OE.refConsultation.Date_Consultation ASC') ;
old   2: VALUES ('&MYPDBUSER', 'Example12', 'Action', 2,
new   2: VALUES ('GESTION_CABINET_MEDICAL', 'Example12', 'Action', 2,

1 row created.

SQL> 
SQL> 
SQL>  INSERT INTO user_workload (username, module, action, priority, sql_text)
  2   VALUES ('&MYPDBUSER', 'Example13', 'Action', 2,
  3   'SELECT
  4  OFA.refPatient.ID_PERSONNE AS ID_PATIENT,
  5  OFA.refPatient.Email AS EMAIL,
  6  OFA.Date_Facture AS Date_Facture,
  7  OFA.refConsultation.Date_Consultation AS Date_Consultation,
  8  SUM(OFA.MONTANT_TOTAL) AS SOMME_MONTANTS
  9  FROM O_FACTURE OFA
 10  GROUP BY
 11  OFA.refPatient.ID_PERSONNE,
 12  OFA.refPatient.Email,
 13  OFA.Date_Facture,
 14  OFA.refConsultation.Date_Consultation
 15  ORDER BY
 16  OFA.refPatient.ID_PERSONNE,
 17  OFA.refPatient.Email,
 18  OFA.Date_Facture,
 19  OFA.refConsultation.Date_Consultation');
old   2:  VALUES ('&MYPDBUSER', 'Example13', 'Action', 2,
new   2:  VALUES ('GESTION_CABINET_MEDICAL', 'Example13', 'Action', 2,

1 row created.

SQL> 
SQL>  INSERT INTO user_workload (username, module, action, priority, sql_text)
  2   VALUES ('&MYPDBUSER', 'Example14', 'Action', 2,
  3   'select E.ID_EXAMEN, E.REFCONSULTATION.DIAGNOSTIC, E.DETAILS_EXAMEN,E.DATE_EXAMEN  from O_EXAMEN E
  4  WHERE E.REFCONSULTATION.ID_CONSULTATION =1') ;
old   2:  VALUES ('&MYPDBUSER', 'Example14', 'Action', 2,
new   2:  VALUES ('GESTION_CABINET_MEDICAL', 'Example14', 'Action', 2,

1 row created.

SQL> 
SQL> 
SQL> commit;

Commit complete.

SQL> 
SQL> 
SQL> --------------------------------------------------------------------------------------------
SQL> --------------------------------------------------------------------------------------------
SQL> -- 3. Analyser les requêtes et produire les recommandations
SQL> --------------------------------------------------------------------------------------------
SQL> --------------------------------------------------------------------------------------------
SQL> 
SQL> 
SQL> -- programmation de tache Sql access advisor
SQL> set serveroutput on
SQL> 
SQL> -- fixer les spérateurs de nombre en Anglais. "," pour les décimaux et "." pour les groupes
SQL> 
SQL> -- Anglais
SQL> alter session set NLS_NUMERIC_CHARACTERS = '.,' ;

Session altered.

SQL> 
SQL> -- Francais
SQL> -- alter session set NLS_NUMERIC_CHARACTERS = ',.'  ;
SQL> declare
  2  saved_stmts NUMBER;
  3  failed_stmts NUMBER;
  4  wkld_name VARCHAR2(30) :='WKLD_GESTION_CABINET_MEDICAL';
  5  taskname VARCHAR2(30) := 'TASK_GESTION_CABINET_MEDICAL';
  6  task_id NUMBER;
  7  num_found NUMBER:=0;
  8  Begin
  9  -- détacher la tache et le workload
 10  select count(*) into num_found
 11  from user_advisor_sqla_wk_map
 12  where task_name = taskname and workload_name = wkld_name;
 13  IF num_found > 0 THEN
 14  DBMS_ADVISOR.RESET_TASK (taskname);
 15  DBMS_ADVISOR.DELETE_SQLWKLD_REF(taskname, wkld_name);
 16  END IF;
 17  
 18  -- suppression puis création de la t
 19  select count(*) into num_found
 20  from dba_advisor_tasks
 21  where owner='&MYPDBUSER' and task_name=taskname;
 22  
 23  IF num_found > 0 THEN
 24  DBMS_ADVISOR.DELETE_TASK (taskname);
 25  END IF;
 26  DBMS_ADVISOR.CREATE_TASK ('SQL Access Advisor', task_id, taskname);
 27  
 28  -- suppression et puis création du workload
 29  select count(*) into num_found
 30  from user_advisor_sqlw_sum
 31  where workload_name = wkld_name;
 32  IF num_found > 0 THEN
 33  DBMS_ADVISOR.DELETE_SQLWKLD(workload_name=> wkld_name);
 34  END IF;
 35  DBMS_ADVISOR.CREATE_SQLWKLD (wkld_name);
 36  
 37  -- chargement du workload
 38  DBMS_ADVISOR.IMPORT_SQLWKLD_USER(
 39  workload_name=> wkld_name,import_mode=>'NEW', owner_name=>'&MYPDBUSER',
 40  table_name=>'USER_WORKLOAD', Saved_rows=>saved_stmts,
 41  Failed_rows=>failed_stmts);
 42  dbms_output.put_line(' saved_stmts='||saved_stmts);
 43  dbms_output.put_line(' failed_stmts='||failed_stmts);
 44  -- Attacher le workload à une tâche
 45  /* Link Workload to Task */
 46  dbms_advisor.add_sqlwkld_ref(taskname,wkld_name);
 47  
 48  --Mise à jour de paramètres de la tâche
 49  dbms_advisor.set_task_parameter(taskname,'EXECUTION_TYPE','INDEX_ONLY');--'FULL');--'INDEX_ONLY');
 50  dbms_advisor.set_task_parameter(taskname,'MODE','COMPREHENSIVE');
 51  
 52  -- exécuter la tâche
 53  DBMS_ADVISOR.EXECUTE_TASK(taskname);
 54  Exception
 55  When others then
 56  dbms_output.put_line(' SQLcode='||sqlcode);
 57  dbms_output.put_line(' SQLerrm='||sqlerrm);
 58  End;
 59  /
old  21: where owner='&MYPDBUSER' and task_name=taskname;
new  21: where owner='GESTION_CABINET_MEDICAL' and task_name=taskname;
old  39: workload_name=> wkld_name,import_mode=>'NEW', owner_name=>'&MYPDBUSER',
new  39: workload_name=> wkld_name,import_mode=>'NEW', owner_name=>'GESTION_CABINET_MEDICAL',
saved_stmts=0                                                                   
failed_stmts=14                                                                 

PL/SQL procedure successfully completed.

SQL> /*
SQL> *
SQL> ERREUR à la ligne 1 :
SQL> ORA-13600: erreur survenue dans Advisor
SQL> ORA-13635: La valeur indiquée pour le paramètre ADJUSTED_SCALEUP_GREEN_THRESH
SQL> ne peut pas être convertie en nombre.
SQL> ORA-06512: à "SYS.PRVT_ADVISOR", ligne 3902
SQL> ORA-06512: à "SYS.DBMS_ADVISOR", ligne 102
SQL> ORA-06512: à ligne 26
SQL> */
SQL> 
SQL> -- ALTER SYSTEM SET NLS_TERRITORY=FRANCE scope=spfile;
SQL> 
SQL> -- si cette apparait faire les  actions suivantes
SQL> -- Ne pas lancer les deux programmes qui suivent
SQL> -- si pas d'erreur
SQL> 
SQL> /*
SQL> -- ne pas exécuter ce script si pas d'erreur plus haut
SQL> declare
SQL> template_id NUMBER;
SQL> template_name VARCHAR2(255):= 'MY_TEMPLATE';
SQL> Begin
SQL> DBMS_ADVISOR.SET_DEFAULT_TASK_PARAMETER (
SQL> 'SQL Access Advisor',
SQL> 'ADJUSTED_SCALEUP_GREEN_THRESH'  ,
SQL> '1,25' -- au lieu de 1.25
SQL> );
SQL> end;
SQL> /
SQL> 
SQL> -- ne pas exécuter ce script si pas d'erreur plus haut
SQL> declare
SQL> template_id NUMBER;
SQL> template_name VARCHAR2(255):= 'MY_TEMPLATE';
SQL> Begin
SQL> DBMS_ADVISOR.SET_DEFAULT_TASK_PARAMETER (
SQL> 'SQL Access Advisor',
SQL> 'OVERALL_SCALEUP_GREEN_THRESH'  ,
SQL> '1,5' -- au lieu de 1.5
SQL> );
SQL> end;
SQL> /
SQL> 
SQL> */
SQL> 
SQL> --------------------------------------------------------------------------------------------
SQL> --------------------------------------------------------------------------------------------
SQL> -- 4. Consulter les recommandations
SQL> --------------------------------------------------------------------------------------------
SQL> --------------------------------------------------------------------------------------------
SQL> 
SQL> -- Consulter les requêtes de référence que va régler SAA
SQL> col WORKLOAD_NAME format a20
SQL> col SQL_TEXT format a70
SQL> set linesize 200
SQL> set pagesize 400
SQL> select WORKLOAD_NAME, sql_id, SQL_TEXT from DBA_ADVISOR_SQLW_STMTS
  2  Where workload_name= 'WKLD_GESTION_CABINET_MEDICAL'
  3  order by sql_id;

WORKLOAD_NAME            SQL_ID SQL_TEXT                                                                                                                                                                
-------------------- ---------- ----------------------------------------------------------------------                                                                                                  
WKLD_GESTION_CABINET         15 SELECT * FROM PATIENT OP                                                                                                                                                
_MEDICAL                                                                                                                                                                                                
                                                                                                                                                                                                        
WKLD_GESTION_CABINET         16 SELECT * FROM CONSULTATION OC                                                                                                                                           
_MEDICAL                                                                                                                                                                                                
                                                                                                                                                                                                        
WKLD_GESTION_CABINET         17 SELECT E.details_examens, COUNT(*) AS NB_LIGNES                                                                                                                         
_MEDICAL                        FROM (SELECT DISTINCT oe.Details                                                                                                                                        
                                                                                                                                                                                                        
WKLD_GESTION_CABINET         18 SELECT E.details_examens, COUNT(*) AS NB_LIGNES                                                                                                                         
_MEDICAL                        FROM (SELECT DISTINCT oe.Details                                                                                                                                        
                                                                                                                                                                                                        
WKLD_GESTION_CABINET         19 SELECT ID_PATIENT_, COUNT (*), SUM (MONTANT_TOTAL)                                                                                                                      
_MEDICAL                            FROM FACTURE                                                                                                                                                        
                                GROUP BY ID_                                                                                                                                                            
                                                                                                                                                                                                        
WKLD_GESTION_CABINET         20 SELECT *                                                                                                                                                                
_MEDICAL                          FROM CONSULTATION C INNER JOIN PATIENT P ON C.ID_PATIENT_ = P.ID_PAT                                                                                                  
                                I                                                                                                                                                                       
                                                                                                                                                                                                        
WKLD_GESTION_CABINET         21 SELECT *                                                                                                                                                                
_MEDICAL                          FROM FACTURE F INNER JOIN PATIENT P ON F.ID_PATIENT_ = P.ID_PATIENT_                                                                                                  
                                                                                                                                                                                                        
WKLD_GESTION_CABINET         22 SELECT *                                                                                                                                                                
_MEDICAL                            FROM CONSULTATION C INNER JOIN PATIENT P ON C.ID_PATIENT_ = P.ID_P                                                                                                  
                                A                                                                                                                                                                       
                                                                                                                                                                                                        
WKLD_GESTION_CABINET         23 SELECT F.ID_PATIENT_, P.EMAIL, SUM (F.MONTANT_TOTAL) MONTANT_TOTAL                                                                                                      
_MEDICAL                            FROM FACT                                                                                                                                                           
                                                                                                                                                                                                        
WKLD_GESTION_CABINET         24 SELECT *                                                                                                                                                                
_MEDICAL                            FROM CONSULTATION C RIGHT JOIN PATIENT P ON C.ID_PATIENT_ = P.ID_P                                                                                                  
                                A                                                                                                                                                                       
                                                                                                                                                                                                        
WKLD_GESTION_CABINET         25 SELECT C.*, P.*, E.*                                                                                                                                                    
_MEDICAL                          FROM CONSULTATION  C                                                                                                                                                  
                                       INNER JOIN PATIENT P ON C.ID_                                                                                                                                    
                                                                                                                                                                                                        
WKLD_GESTION_CABINET         26 SELECT F.*, P.*, C.*                                                                                                                                                    
_MEDICAL                          FROM FACTURE  F                                                                                                                                                       
                                       INNER JOIN PATIENT P ON F.ID_PATIE                                                                                                                               
                                                                                                                                                                                                        
WKLD_GESTION_CABINET         27 SELECT C.*, P.*, E.*                                                                                                                                                    
_MEDICAL                            FROM CONSULTATION C                                                                                                                                                 
                                         INNER JOIN PATIENT P ON C.                                                                                                                                     
                                                                                                                                                                                                        
WKLD_GESTION_CABINET         28 SELECT F.ID_PATIENT_,                                                                                                                                                   
_MEDICAL                                 P.EMAIL,                                                                                                                                                       
                                         SUM (F.MONTANT_TOTAL)     MONTA                                                                                                                                
                                                                                                                                                                                                        

14 rows selected.

SQL> 
SQL> 
SQL> -- Visualisation des recommandations
SQL> -- Affiche du nr de recommandation, le rang et le bénéfice de
SQL> -- la recommandation
SQL> 
SQL> SELECT REC_ID, RANK, BENEFIT, type
  2  FROM USER_ADVISOR_RECOMMENDATIONS WHERE TASK_NAME = 'TASK_GESTION_CABINET_MEDICAL';

no rows selected

SQL> 
SQL> -- Visualisation des recommandations
SQL> -- Afficher des recommandations et des bénéfices
SQL> -- par requêtes
SQL> 
SQL> SELECT sql_id, rec_id, precost, postcost,
  2  (precost-postcost)*100/precost AS percent_benefit
  3  FROM USER_ADVISOR_SQLA_WK_STMTS
  4  WHERE TASK_NAME = 'TASK_GESTION_CABINET_MEDICAL'
  5  AND workload_name = 'WKLD_GESTION_CABINET_MEDICAL';

no rows selected

SQL> 
SQL> -- Visualisation des recommandations
SQL> -- Affichage des actions recommandés :
SQL> -- Comptage des actions recommandées
SQL> 
SQL> 
SQL> SELECT 'Action Count', COUNT(DISTINCT action_id) cnt
  2  FROM user_advisor_actions
  3  WHERE task_name = 'TASK_GESTION_CABINET_MEDICAL';

'ACTIONCOUNT        CNT                                                                                                                                                                                 
------------ ----------                                                                                                                                                                                 
Action Count          0                                                                                                                                                                                 

SQL> 
SQL> 
SQL> 
SQL> -- Visualisation des recommandations
SQL> -- Affichage des actions recommandés :
SQL> -- Liste des actions recommandées
SQL> 
SQL> 
SQL> Col command format A30
SQL> Col attr1 format A40
SQL> Set long 500
SQL> SELECT rec_id, action_id, command, attr1
  2  FROM user_advisor_actions
  3  WHERE task_name = 'TASK_GESTION_CABINET_MEDICAL'
  4  ORDER BY rec_id, action_id;

no rows selected

SQL> 
SQL> 
SQL> -- Visualisation des recommandations
SQL> -- Génération des scripts SQL
SQL> -- Afin d'implémenter les recommandations il est possible de
SQL> -- générer des scripts
SQL> 
SQL> -- La fonction GET_TASK_SCRIPT construire le script
SQL> set serveroutput on
SQL> begin
  2  dbms_output.put_line(DBMS_ADVISOR.GET_TASK_SCRIPT('TASK_GESTION_CABINET_MEDICAL'));
  3  end;
  4  /
Rem  SQL Access Advisor: Version 21.0.0.0.0 - Production
Rem  
Rem  Username:        GESTION_CABINET_MEDICAL
Rem  Task:            TASK_GESTION_CABINET_MEDICAL
Rem  Execution date:  27/10/2024        
19:22
Rem  

                                                                                                                                                                                           

PL/SQL procedure successfully completed.

SQL> 
SQL> -- La fonction CREATE_FILE permet de créer le fichier
SQL> -- contenant le script
SQL> declare
  2  mydate varchar2(20):=to_char(sysdate, 'DD_MM_YYYY_HH24_MI_SS');
  3  fname varchar2(300):='SAA_Generate_script_on_gestion_cabinet_medical_app_'||mydate||'.sql';
  4  begin
  5  dbms_output.put_line(fname);
  6  DBMS_ADVISOR.CREATE_FILE(
  7  buffer=>DBMS_ADVISOR.GET_TASK_SCRIPT('TASK_GESTION_CABINET_MEDICAL'),
  8  location =>'DATA_PUMP_DIR',
  9   filename=>fname
 10  );
 11  end;
 12  /
SAA_Generate_script_on_gestion_cabinet_medical_app_27_10_2024_19_22_39.sql                                                                                                                              

PL/SQL procedure successfully completed.

SQL> 
SQL> spool off
